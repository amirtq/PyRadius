# PyRadius MariaDB Configuration - Performance Optimized
# Server: 12GB RAM | Storage: SSD assumed
# This file is mounted to /etc/mysql/conf.d/pyradius.cnf

[mysqld]
# ===========================================
# CHARACTER SET AND COLLATION
# ===========================================
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci

# ===========================================
# CONNECTION SETTINGS
# ===========================================
max_connections = 500
wait_timeout = 28800
interactive_timeout = 28800
thread_cache_size = 50
thread_pool_size = 8

# ===========================================
# INNODB BUFFER POOL (Primary Performance Setting)
# ===========================================
# 4GB buffer pool (~33% of 12GB RAM - safe for shared system)
innodb_buffer_pool_size = 4G
innodb_buffer_pool_instances = 4

# Fast startup - don't preload buffer pool data
innodb_buffer_pool_load_at_startup = OFF
innodb_buffer_pool_dump_at_shutdown = OFF

# ===========================================
# INNODB LOG SETTINGS
# ===========================================
# Larger log files for better write performance
# Note: log files will be recreated on first startup after change
innodb_log_file_size = 512M
innodb_log_buffer_size = 64M
innodb_flush_log_at_trx_commit = 2
innodb_flush_method = O_DIRECT

# ===========================================
# INNODB I/O SETTINGS (SSD Optimized)
# ===========================================
innodb_io_capacity = 2000
innodb_io_capacity_max = 4000
innodb_read_io_threads = 8
innodb_write_io_threads = 8
innodb_lru_scan_depth = 256

# ===========================================
# QUERY BUFFER SIZES
# ===========================================
join_buffer_size = 4M
sort_buffer_size = 4M
read_buffer_size = 2M
read_rnd_buffer_size = 2M
tmp_table_size = 64M
max_heap_table_size = 64M

# ===========================================
# TABLE CACHE SETTINGS
# ===========================================
table_open_cache = 4000
table_definition_cache = 2000
open_files_limit = 65535

# ===========================================
# PERFORMANCE SCHEMA (Reduced overhead)
# ===========================================
performance_schema = ON
performance_schema_max_table_instances = 500
performance_schema_max_file_instances = 500

# ===========================================
# LOGGING (Uncomment to enable slow query log)
# ===========================================
# slow_query_log = 1
# slow_query_log_file = /var/log/mysql/slow.log
# long_query_time = 2
log_error = /var/log/mysql/error.log

# ===========================================
# BINARY LOGGING (Uncomment for replication)
# ===========================================
# log_bin = mysql-bin
# server_id = 1
# binlog_format = ROW
# expire_logs_days = 7

# ===========================================
# SECURITY
# ===========================================
local_infile = 0
symbolic-links = 0

# Allow network connections
bind-address = 0.0.0.0

# ===========================================
# CLIENT SETTINGS
# ===========================================
[client]
default-character-set = utf8mb4

[mysql]
default-character-set = utf8mb4
